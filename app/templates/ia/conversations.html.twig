{% extends 'base.html.twig' %}

{% block title %}Conversations avec {{ agent.nom }}{% endblock %}

{% block body %}
    <a href="{{ path('app_ia_index') }}">&larr; Retour au choix de l'assistant</a>

    <h1>Conversations avec "{{ agent.nom }}"</h1>

    {# Le lien pour une nouvelle conversation pointe vers la route 'app_ia_chat' SANS id #}
    {# en passant l'id de l'agent en paramètre de requête #}
    <a href="{{ path('app_ia_chat', {agentId: agent.id}) }}" style="display: inline-block; padding: 10px 15px; background-color: #28a745; color: white; text-decoration: none; border-radius: 5px; margin-bottom: 20px;">
        Nouvelle conversation
    </a>

    <hr>

    <h2>Historique des conversations</h2>

    {% if conversations is not empty %}
        <ul style="list-style: none; padding: 0;">
            {% for conversation in conversations %}
                <li style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 10px; border-bottom: 1px solid #eee;">
                    <a href="{{ path('app_ia_chat', {id: conversation.id}) }}">
                        {# Utilisation du filtre 'date' de Twig #}
                        Conversation du {{ conversation.dateCreation|date('d-m-Y à H:i') }}
                    </a>
                    <form method="post" action="{{ path('app_ia_conversation_delete', {id: conversation.id}) }}" style="margin: 0;">
                        {# Ajout du token CSRF pour la sécurité #}
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ conversation.id) }}">
                        <button type="submit" onclick="return confirm('Êtes-vous sûr de vouloir supprimer cette conversation ?');
                            "style="background: none; border: 1px solid #dc3545; color: #dc3545; border-radius: 5px; cursor: pointer; padding: 5px 10px;"
                        >
                            Supprimer
                        </button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    {% else %}
            <p>Aucun historique de conversation avec cet assistant.</p>
    {% endif %}

{% endblock %}